<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 세카이 유틸리티</title>

    <!-- Scripts -->
    <script type="importmap">
    { "imports": { "/": "./js/" } }
    </script>
    <script type="module" src="js/App.js?v='0.05'"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
<div id="app">
    <header class="header">
        <h1 class="main-title">프로세카 유틸리티</h1>
    </header>
    <nav class="navbar">
        <ul class="main-nav draggable-on-mobile">
            <!-- 메인 툴 전환 버튼들 -->
            <li><button class="nav-button active" data-action="toggle-tool" data-target="tool-event-point-calculator">이벤트 포인트</button></li>
            <li><button class="nav-button" data-action="toggle-tool" data-target="tool-skill-comparison">스킬값 비교기</button></li>
            <li><button class="nav-button" data-action="toggle-tool" data-target="tool-placeholder-3">??3</button></li>

            <li class="nav-separator"></li>

            <!-- 팝업 열기 버튼들 -->
            <li><button class="nav-button" data-action="open-popup" data-popup-trigger="character-ranks-panel">캐릭터 랭크</button></li>
            <li><button class="nav-button" data-action="open-popup" data-popup-trigger="backup-panel">백 업</button></li>
        </ul>
    </nav>
    <!-- 팝업 패널들 -->
    <div class="popup-wrapper">
        <div id="character-ranks-panel" class="popup-panel" data-popup-id="character-ranks-panel" data-popup-position="header">
            <div class="popup-panel-title-bar">
                <span class="popup-panel-title">캐릭터 랭크 관리</span>
                <button class="popup-close-btn">×</button>
            </div>
            <div id="character-ranks-content" class="scrollable-content"></div>
        </div>

        <div id="backup-panel" class="popup-panel" data-popup-id="backup-panel" data-popup-position="header">
            <div class="popup-panel-title-bar">
                <span class="popup-panel-title">데이터 백업 / 복원</span>
                <button class="popup-close-btn">×</button>
            </div>
            <div class="backup-actions scrollable-content">
                <button id="exportDataBtn" class="btn btn-md btn-success">저장</button>
                <label for="importFile" class="btn btn-md btn-info">불러오기</label>
                <input type="file" id="importFile" class="input" accept=".json" style="display: none;">
                <button id="clearDataBtn" class="btn btn-md btn-secondary">삭제</button>
            </div>
        </div>
    </div>

    <main class="container">
        <div id="message-display" class="message"></div>

        <!-- 이벤트 포인트 계산기 -->
        <section id="tool-event-point-calculator" class="tool-section tabs">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="ep-ne-calc-main">자연불</button>
                <button class="tab-button" data-tab="ep-event-run-tab">이벤런(미작성)</button>
            </div>
            
            <div class="tab-content-wrapper">
                <!-- 자연불 -->
                <div id="ep-ne-calc-main" class="tab-content active">
                    <div class="action-buttons">
                        <button id="ep-ne-reset-btn" class="btn btn-sm btn-secondary">초기화</button>
                    </div>
                    <div class="ep-calculator">
                        <div class="card">
                            <h3>이벤트 정보</h3>
                            <div class="card-grid">
                                <div class="config-row">
                                    <div class="form-group"><label for="ep-ne-start-date">시작일</label><input type="date" id="ep-ne-start-date" class="input input-md"></div>
                                    <div class="form-group"><label for="ep-ne-end-date">종료일</label><input type="date" id="ep-ne-end-date" class="input input-md"></div>
                                </div>
                                <div class="form-group"><label for="ep-ne-start-time">시작 시간</label><select id="ep-ne-start-time" class="input input-md"><option value="15">일반 (15시->21시)</option><option value="20">월링 (20시->20시)</option></select></div>
                            </div>
                        </div>
                        <div class="card">
                            <h3>내 정보</h3>
                            <div class="card-grid">
                                <div class="config-row">
                                    <div class="form-group"><label for="ep-ne-current-ep">현재 EP</label><input type="number" id="ep-ne-current-ep" class="input input-md"></div>
                                    <div class="form-group"><label for="ep-ne-target-ep">목표 EP</label><input type="number" id="ep-ne-target-ep" class="input input-md"></div>
                                </div>
                                <div class="config-row">
                                    <div class="form-group"><label for="ep-ne-current-energy">현재 불</label><input type="number" id="ep-ne-current-energy" class="input input-md"></div>
                                    <div class="form-group"><label for="ep-ne-extra-energy">추가 불 (캔, 랭크업)</label><input type="number" id="ep-ne-extra-energy" class="input input-md"></div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <h3>획득량 정보</h3>
                            <div class="card-grid">
                                <div class="config-row">
                                    <div class="form-group">
                                        <label for="ep-ne-per-5-ep">평균 EP (5불 기준)</label>
                                        <input type="number" id="ep-ne-per-5-ep" class="input input-md">
                                    </div>
                                    <div class="form-group">
                                        <label for="ep-ne-challenge-live-ep">챌린지 라이브 EP</label>
                                        <div class="toggle-input-wrapper">
                                            <input type="number" id="ep-ne-challenge-live-ep" class="input input-md">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="ep-ne-challenge-live-toggle" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ep-ne-mysekai-ep">마이세카이 EP</label>
                                    <div class="toggle-input-wrapper">
                                        <input type="number" id="ep-ne-mysekai-ep" class="input input-md">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="ep-ne-mysekai-toggle" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card ep-ne-results">
                            <h3>예측 결과</h3>
                            <div class="timer-display">
                                <p>현재 시간: <span id="ep-ne-current-time">--</span></p>
                                <p>남은 시간: <span id="ep-ne-time-left">--</span></p>
                            </div>
                            <div class="result-grid">
                                <p>획득 가능 EP:</p> <span id="ep-ne-result-achievable">0</span>
                                <p class="total">최종 예측 EP:</p> <span id="ep-ne-result-total" class="total">0</span>
                                <p>남은 EP:</p> <span id="ep-ne-result-remaining">0</span>
                                <p>추가 필요 불:</p> <span id="ep-ne-result-needed-energy">0 불</span>
                            </div>
                        </div>
                        <div class="card ep-ne-results">
                            <h3>앞으로 남은 양</h3>
                            <div class="result-grid">
                                <p>자연불:</p> <span id="ep-ne-remain-natural-energy">0 불</span>
                                <p>광고불:</p> <span id="ep-ne-remain-ad-energy">0 불</span>
                                <p>챌린지 라이브:</p> <span id="ep-ne-remain-challenge">0 회</span>
                                <p>마이세카이:</p> <span id="ep-ne-remain-mysekai">0 회</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 이벤런 -->
                <div id="ep-event-run-tab" class="tab-content">
                    <h2>이벤런 계산기 (개발 예정)</h2>
                    <p>이곳에 새로운 기능이 추가될 예정입니다.</p>
                </div>
            </div>
        </section>

        <!-- 스킬값 비교기 -->
        <section id="tool-skill-comparison" class="tool-section tabs">
            <!-- 팝업 -->
            <div id="auto-input-panel" class="popup-panel" data-popup-id="auto-input-panel" data-popup-position="trigger">
                <div class="popup-panel-title-bar">
                    <span class="popup-panel-title">대상값 자동 입력</span>
                    <button class="popup-close-btn">×</button>
                </div>
                <div class="auto-input-controls scrollable-content">
                    <div class="config-group">
                        <label for="auto-input-start">시작값</label>
                        <input type="number" id="auto-input-start" class="input input-md">
                    </div>
                    <div class="config-group">
                        <label for="auto-input-end">끝나는값</label>
                        <input type="number" id="auto-input-end" class="input input-md">
                    </div>
                    <div class="config-group">
                        <label for="auto-input-increment">증가값</label>
                        <input type="number" id="auto-input-increment" class="input input-md">
                    </div>
                    <button id="applyAutoInputBtn" class="btn btn-md btn-primary">적 용</button>
                </div>
            </div>

            <div class="tab-buttons">
                <button class="tab-button" data-tab="skill-level-tab">스킬 레벨</button>
                <button class="tab-button" data-tab="rank-skill-tab">랭 크</button>
            </div>
            
            <div class="tab-content-wrapper">
                <!-- 스킬 레벨별 비교 -->
                <div id="skill-level-tab" class="tab-content">
                    <h2>스킬 레벨별 비교</h2>
                    <div class="table-config-group draggable-on-mobile">
                        <div class="config-group">
                            <label for="character-select">캐릭터 선택</label>
                            <select id="character-select" class="input input-sm"></select>
                        </div>
                        <div class="config-group">
                            <label for="character-rank-input">랭크 입력</label>
                            <input type="number" id="character-rank-input" class="input input-sm" value="1">
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="autoInputTriggerBtn-char" class="btn btn-sm btn-primary" data-popup-trigger="auto-input-panel">자동 입력</button>
                        <button id="btn-display-mode-char" class="btn btn-sm btn-secondary">높은 값</button>
                        <button id="btn-number-format-char" class="btn btn-sm btn-secondary">정수</button>
                    </div>
                    <div class="table-display-info draggable-on-mobile">
                        <div id="display-mode-label-char" class="display-mode-label"></div>
                        <div class="legend-container">
                            <div class="legend-item"><span class="legend-color legend-blue"></span> 각후 유리</div>
                            <div class="legend-item"><span class="legend-color legend-yellow"></span> 각전 유리</div>
                            <div class="legend-item"><span class="legend-color legend-gray"></span> 동일</div>
                        </div>
                    </div>
                    <div class="skill-table-container">
                        <table id="skill-level-table" class="skill-table"></table>
                    </div>
                </div>
                
                <!-- 랭크별 비교 -->
                <div id="rank-skill-tab" class="tab-content">
                    <h2>랭크별 비교</h2>
                    <div class="table-config-group draggable-on-mobile">
                        <div class="config-group">
                            <label for="skill-level-select">스킬 레벨</label>
                            <select id="skill-level-select" class="input input-sm">
                                <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label>랭크 범위</label>
                            <div class="rank-range-inputs"> 
                                <input type="number" id="rank-min" class="input input-sm"><span>~</span><input type="number" id="rank-max" class="input input-sm">
                            </div>
                        </div>
                        <div class="config-group">
                            <label for="rank-increment">랭크 증가량</label>
                            <input type="number" id="rank-increment" class="input input-sm">
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="autoInputTriggerBtn" class="btn btn-sm btn-primary" data-popup-trigger="auto-input-panel">자동 입력</button>
                        <button id="btn-display-mode" class="btn btn-sm btn-secondary">높은 값</button>
                        <button id="btn-number-format" class="btn btn-sm btn-secondary">정수</button>
                    </div>
                    <div class="table-display-info draggable-on-mobile">
                        <div id="display-mode-label" class="display-mode-label"></div>
                        <div class="legend-container">
                            <div class="legend-item"><span class="legend-color legend-blue"></span> 각후 유리</div>
                            <div class="legend-item"><span class="legend-color legend-yellow"></span> 각전 유리</div>
                            <div class="legend-item"><span class="legend-color legend-gray"></span> 동일</div>
                        </div>
                    </div>
                    <div class="skill-table-container">
                        <table id="rank-skill-table" class="skill-table"></table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. 나중에 추가될 ??3 기능 섹션 -->
        <section id="tool-placeholder-3" class="tool-section">
            <h2>임시</h2>
            <p>임시 공간</p>
        </section>
    </main>
    <footer class="footer">
        <p>프로세카 유틸리티</p>
    </footer>
</div>
</body>
</html>